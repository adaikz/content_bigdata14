#  Code review. Правила

## I. Для чего нам нужен code review на программе?

Мы решили внедрить процесс кода ревью на нашей программе, чтобы еще на стадии обучения вы могли привыкать к лучшим практикам в написании качественного кода, делиться своими открытиями с коллегами, а также способствовать обучению друг друга, предлагая более грамотные решения и давая обратную связь.

При адаптации процесса кода ревью для программы мы опирались на мировые практики, использовали положения знаменитых [PEP8](https://www.python.org/dev/peps/pep-0008/#introduction) и [PEP20](https://www.python.org/dev/peps/pep-0020/), а также наработки Артема Селезнева в части [обзора кода ревью для Data Scientist / Analysts / Engineer (DS|DA)](https://github.com/NameArtem/tutorials_and_presentations/blob/master/codeReview/CodeRivew.md).


## II. Как будет организован code review на программе?

Код ревью будет распространяться только на лабораторные работы (без суперачивок и проектов) со второй по шестую.

У вас будут одни сутки на то, чтобы закоммитить свое решение в соответствующую папку в git (например, `/code-reviews/lab02/solutions`).

Далее на основе имеющихся решений мы разбиваем вас на пары, список peers будет лежать в файле [code_reviews_list.md](./code_reviews_list.md).

Код ревью своего напарника необходимо сделать до дедлайна текущей лабы.

Код ревью вы можете оформлять в виде markdown-документа или оставлять комментарии в самом коде внутри python-скрипта или jupyter-ноутбука, главное, чтобы ваш *peer* c легкостью мог их найти. И после того, как код ревью готов, вы его коммитите в репозиторий программы в папку `/code-reviews/lab02/reviews` (т.е решения - в папку `solutions`, а код ревью - в папку `reviews`). Название вашего файла должно быть со следующим шаблоном: `lab02_name.surname.*`.

**ВАЖНО: При обмене своими работами удаляйте свои логины и пароли в коде, если использовали**

Ниже представлены те шаги, которые нужно выполнить, чтобы это сделать (предполагается, что вы уже склонировали себе репозиторий и находитесь в его папке на своем компьютере).

* на Github.com: Форкнуть newprolab/content_bigdata14
* Склонировать этот форк <ваш ник>/content_bigdata14 (git clone ...) к себе на лаптоп или на мастере.
* Создать там свою ветку name.surname (git branch ...) .
* Переключится на свою ветку (git checkout ...).
* Выполнить добавление новых файлов в директорию **/code-reviews/labХХ/reviews** (git add), например lab02_name.surname.ipynb.
* Сделать commit + push (оставляйте комментарии)
* В GitHub.com создать pull request:
   * Начать с главной страницы репозитория
   * Нажать branches
   * New pull request из вашей ветки name.surname в нашу ветку **main**

Выполнять Merge не нужно.

Можете проверить, что все ок, на [странице репозитория на GitHub](https://github.com/newprolab/content_bigdata14).

После этого зайдите на [эту страницу в Личном кабинете](https://lk.newprolab.com/lab/code_rvw) и нажмите "Проверить". Это нужно будет делать после каждого кода ревью. Вам там будут начисляться доп. баллы.

## III. Как проводить code review?
Прежде всего во время проведения кода ревью спрашивайте себя: ***"Достаточно ли я корректен и вежлив по отношению к своему коллеге?"*** Этот вопрос поможет вам не только поделиться своим мнением, но и построить доверительные и уважительные отношения друг с другом.

Чтобы знать, с чего начинать и на какие моменты имеет смысл обращать внимание, мы предлагаем вам использовать чек-лист.

### Часть 1. Архитектура кода

#### 1. Корректен ли выбранный подход с логической точки зрения?
Есть ли логические ошибки в рассуждениях? Если есть, укажите, какие именно.

**Пример**:

```python
>>> def avg_of_2(a, b, c):
...     return a + b + c / 2
...
>>> avg_of_2(4, 8, 12)  # Вернет 6 вместо 8
```

#### 2. Насколько эффективен код и алгоритм решения задачи?
Можно ли перебор по циклу заменить на использование специальных функций? Можно ли вначале как-то отфильтровать значения или отсортировать их, и дальше упростить дальнейшие вычисления?

**Пример**: Вы проверяете код, работающий с числовыми значениями, у которого на входе список из int / float, а на выходе – обработанные значения из этого списка с применением некоторого условия. Если ваш коллега решил искать значения через цикл, то исправьте это.

```Python
"""
   valueList - всегда список числовых значений
   trigger - float значение, если значние в valueList больше или равно trigger, совершается действие
"""
# Было
for i in valueList:
     if i >= trigger:
          # action

# Если ограничить список заранее и отсортировать его, то мы уменьшим количество операций в цикле for

# Будет
valueList = sorted(valueList, key=lambda x: x >= trigger)
# action
```

### Часть 2. Лучшие практики в написании кода

#### 3. Используются ли возможности языка?
Используйте все возможности языка, и при его обновлении переходите на новые версии в своих экспериментах.

**Пример**: Коллега может создать дополнительный счетчик в коде и использовать его.

```Python
""" 
   Задача: создать список из кортежей с именем и характеристиками, сортировка по убыванию
   [('name', i, parameter)]
"""

# Создано с самодельным счетчиком
val = 0
for name in workers:
   # action
   val += 1

# используем возможности яызыка
result = [(worker.age, i, worker) for i, worker in enumerate(workers)]
result.sort()
result = [worker for age, i, worker in result]
```

**Важно!** Не заиграйтесь с возможностями языка! На примерах выше был Python, но на других языках, которые используют DS | DA, возможности языка могут сделать его плохо читаемым (как в случае Scala).

#### 4. Содержит ли код повторяющиеся куски (DRY code – do not repeat yourself)?

Если код, который вы видите, повторяется 2 и более раза, напишите комментарий, что эту часть необходимо убрать и сделать функцией или компонентом. Если невозможно сделать функцией, предложите переосмыслить этот отрезок кода.

**Пример**:

```SQL
/*
   Используем with, как способ неповторения кода
*/

-- было
SELECT DISTINCT
      yo.snap_date
      , yo.user_id
      , yo.amb_id
      , yo.amb_name
FROM
    tbl.you_ambitions yo
LEFT JOIN
    opt.target t
       ON t.trg in (SELECT DISTINCT yo.amb_id FROM tbl.you_ambitions yo WHERE 1 = 1 AND yo.amb_trg = 1)
WHERE
     1 = 1
  AND
     yo.amb_trg = 1
    
-- Уберем в WITH
-- Коллега, повторяющиеся селекты используем в WITH

-- будет замена на WITH 
WITH amb
AS (SELECT --+ MATERIALIZED
           DISTINCT
           yo.snap_date
           , yo.user_id
           , yo.amb_id
      	   , yo.amb_name
    FROM
        tbl.you_ambitions yo
    WHERE
         1 = 1
      AND
         yo.amb_trg = 1
)

..etc
```
#### 5. Содержит ли код захардкоженные значения/переменные?

Если да, есть ли способы не использовать их? Предложите эти способы.

#### 6. Содержит ли код многочисленные условия if/else и циклы (более 3 для условий и более 2 для циклов)?

**Пример**:

```Python
"""
   При содании train / test рейтингов
   используется множестванная переборка и работа со списком
"""

# плохой пример
factY = []
predY = []

for (user, itemsRating) in userItemRecs:
    for (rating, item) in itemsRating:
        for (testItem, testRating) in testRating[user]:
	          if testItem == item:
	        #action
```

#### 7. Содержит ли код длинные функции, состоящие из нескольких веток?

Если да, как можно разбить их на более простые и дискретные? Предложите варианты.

**Пример**: Ниже представлен пример функции, которая делает два типа операций: вычисление и вывод, что не есть хорошо.

```Python
# функции следует дробить на однозадачные, в каждой из которых заключен единственный аспект работы
def calculate_and print_stats(list_of_numbers):
    sum = sum(list_of_numbers)
    mean = statistics.mean(list_of_numbers)
    median = statistics.median(list_of_numbers)
    mode = statistics.mode(list_of_numbers)

    print('-----------------Stats-----------------')
    print('SUM: {}'.format(sum)
    print('MEAN: {}'.format(mean)
    print('MEDIAN: {}'.format(median)
    print('MODE: {}'.format(mode)
```

#### 8. Содержит ли код проверки на null-значения и обработку ошибок (если по условию задачи в этом есть необходимость)?

Если не содержит, укажите в каких местах эти проверки стоит добавить.

**Совет:** Варианты работы с исключениями представлены по [ссылке](https://www.yuripetrov.ru/edu/python/ch_07_01.html#python).

#### 9. Содержит ли код комментарии?

Обращайте внимание на то, используется ли один и тот же вариант комментирования в рамках ноутбука: строчные (`#`, `//`, `--`) или многострочные (`/**/`) оформления комментариев.

### Часть 3. Стиль написания кода

#### 10. Содержит ли скрипт закомментированный (неиспользуемый) код?

#### 11. Содержит ли скрипт долгоисполняемые ячейки или циклы?

Если ячейки выполняются >1мин, они должны содержать метакоманду %%time и предупреждение о времени исполнения. Для циклов используйте `tqdm-notebook`.

#### 12. Содержит ли ноутбук заголовки, подзаголовки разных уровней?

#### 13. Понятно ли именование переменных?

Обращайте внимание на то, одинаковым ли образом именуются переменные в рамках ноутбука: прописные и строчные буквы, все строчные, использование нижнего подчеркивания и т.д.

#### 14. Соблюдается ли требования к длине строки согласно PEP8 (79 символов для кода, 72 для комментариев и докстрингов)?
Мы здесь не придерживаемся строгих правил, однако договариваемся о том, что строка должна помещаться на экране 17" без горизонтального скроллинга.

#### 15. Соблюдаются ли требования к [импорту модулей](https://www.python.org/dev/peps/pep-0008/#imports) согласно PEP8?

#### 16. Соблюдаются ли требования к [пробелам](https://www.python.org/dev/peps/pep-0008/#whitespace-in-expressions-and-statements) согласно PEP8?

#### 17. Ограничено ли число строк при выводе датафреймов или серий?

Мы рекомендуем использовать функции .head() или .tail() при выводе датафреймов или серий для лучшей читаемости ноутбука.

# FAQ

1. Code review делается только для лаб, а ачивки?

   **Ответ:** Только лабы.

2. Name.surname - это имя ревьюера?

   **Ответ:** Да, имя ревьюера.

3. Код и маппера и редьюсера в одном файле, а папку с именем ревьюера создать нельзя?
   
   **Ответ:** Должен быть один файл. Маппер и редьюсер можно объединить в один файл. Просто папки создавать не надо.
